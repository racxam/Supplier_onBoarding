sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/core/Icon","sap/m/Link","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/Dialog","sap/m/Button","sap/m/Text"],function(e,t,a,o,r,n,s,i){"use strict";return e.extend("com.sumo.supplieronboarding.controller.RequestForm",{onInit:function(){this.onReadSupplierSpendType();this.onReadNatureofActivity();this.onReadDepartments();this.onReadSector();var e=new Date;var t=new Date;t.setFullYear(e.getFullYear()+4);var a=this.byId("datePicker");a.setMinDate(e);a.setMaxDate(t);var o=new sap.ui.model.json.JSONModel({panCardValue:"",gstinValue:"",emailValue:"",numberValue:"",pan:[],gst:[]});this.getView().setModel(o)},onPanCardChange:function(e){var t=e.getSource();var a=t.getValue();var o=/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/;if(o.test(a)){t.setValueState("Success")}else{t.setValueState("Error")}},onGSTINChange:function(e){var t=e.getSource();var a=t.getValue();var o=/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;var r=this.getView().getModel().getProperty("/panCardValue");if(o.test(a)){var n=a.substring(2,12);if(n===r){t.setValueState("Success")}else{t.setValueState("Error");t.setValueStateText("The PAN part of the GSTIN does not match the entered PAN.")}}else{t.setValueState("Error");t.setValueStateText("Invalid GSTIN format. Please enter a valid GSTIN.")}},onSubmitpan:function(){var e=this.byId("panInput");var a=e.getValue();if(e.getValueState()==="Success"){t.show("PAN Card number is valid: "+a)}else{t.show("Please enter a valid PAN Card number.")}},onSubmitgst:function(){var e=this.byId("gstinInput").getValue().trim();var a=this.getView().getModel("customerModel");var o=a.getProperty("/customers");var r=o.find(function(t){return t.GSTIN===e});if(r){var n=new sap.m.Dialog({title:"Customer Details",content:new sap.m.Text({text:"  Name: "+r.Name+"\n"+"  Address: "+r.Address+"\n"+"  Contact Number: "+r.ContactNumber}),beginButton:new sap.m.Button({text:"OK",press:function(){n.close()}}),afterClose:function(){n.destroy()}});n.open()}else{t.show("GSTIN not found!")}},onEmailChange:function(e){var t=e.getSource();var a=t.getValue();var o=/^[a-zA-Z0-9!#$%&'*+?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+?^_`{|}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])$/;if(o.test(a)){t.setValueState("Success")}else{t.setValueState("Error")}},onSubmitemail:function(){var e=this.byId("emailInput");var a=e.getValue();if(e.getValueState()==="Success"){t.show("Email is valid: "+a)}else{t.show("Please enter a valid email address.")}},onNumberChange:function(e){var t=e.getSource();var a=t.getValue();a=a.replace(/\D/g,"");if(a.length>10){a=a.substring(0,10)}t.setValue(a);if(a.length===10){t.setValueState("Success")}else{t.setValueState("Error");t.setValueStateText("Mobile number must be 10 digits.")}},onSubmitnumber:function(){var e=this.byId("numberInput");var a=e.getValue();if(e.getValueState()==="Success"){t.show("Number is valid: "+a)}else{t.show("Please enter a valid Mobile number.")}},onDownload:function(e){var t=e.getSource();var a=t.getCustomData()[0].getValue();var o=t.getText();var r=document.createElement("a");r.href=a;r.download=o;document.body.appendChild(r);r.click();document.body.removeChild(r)},onDeleteFilepan:function(e){var a=e.getSource();var o=a.getParent().getParent();var r=this.getView().getModel();var n=r.getProperty("/pan");var s=o.getBindingContext().getPath().split("/").pop();n.splice(s,1);r.setProperty("/pan",n);t.show("File deleted successfully.")},onDeleteFilegst:function(e){var a=e.getSource();var o=a.getParent().getParent();var r=this.getView().getModel();var n=r.getProperty("/gst");var s=o.getBindingContext().getPath().split("/").pop();n.splice(s,1);r.setProperty("/gst",n);t.show("File deleted successfully.")},onFileUploadpan:function(e){var a=e.getSource();var o=a.oFileUpload.files[0];if(o){var r=o.name;var n=new FileReader;var s=this;n.onload=function(e){var a=e.target.result;var o=s.getView().getModel();var n=o.getProperty("/pan");n.push({fileName:r,fileUrl:a});o.setProperty("/pan",n);console.log("Updated /Pan attachment:",o.getProperty("/pan"));t.show("File "+r+" uploaded successfully.");o.refresh(true)};n.readAsDataURL(o)}},formatAttachmentButtonTextpan:function(e){if(e&&e.length>0){return"View Attachments ("+e.length+")"}else{return"View Attachments (0)"}},onFileUploadgst:function(e){var a=e.getSource();var o=a.oFileUpload.files[0];if(o){var r=o.name;var n=new FileReader;var s=this;n.onload=function(e){var a=e.target.result;var o=s.getView().getModel();var n=o.getProperty("/gst");n.push({fileName:r,fileUrl:a});o.setProperty("/gst",n);console.log("Updated /Gst attachment:",o.getProperty("/gst"));t.show("File "+r+" uploaded successfully.");o.refresh(true)};n.readAsDataURL(o)}},formatAttachmentButtonTextgst:function(e){if(e&&e.length>0){return"View Attachments ("+e.length+")"}else{return"View Attachments (0)"}},onOpenDialogpan:function(){if(!this._oPanDialog){this._oPanDialog=this.getView().byId("panDialog");if(!this._oPanDialog){this._oPanDialog=sap.ui.xmlfragment("com.sumo.supplieronboarding.view.fragment.uploadfile",this);this.getView().addDependent(this._oPanDialog)}}this._oPanDialog.open()},onOpenDialoggst:function(){if(!this._oGstDialog){this._oGstDialog=this.getView().byId("gstDialog");if(!this._oGstDialog){this._oGstDialog=sap.ui.xmlfragment("com.sumo.supplieronboarding.view.fragment.uploadfile",this);this.getView().addDependent(this._oGstDialog)}}this._oGstDialog.open()},onCloseDialogpan:function(){if(this._oPanDialog){this._oPanDialog.close()}},onCloseDialoggst:function(){if(this._oGstDialog){this._oGstDialog.close()}},onFormsubmit:function(){var e=this.getView();var a=this.getOwnerComponent().getModel();console.log(a);var o={validity:e.byId("datePicker").getDateValue(),relatedParty:e.byId("radioGroup").getSelectedButton().getText(),supplierSpendType:e.byId("supplierSpendType").getSelectedKey(),natureOfActivity:e.byId("NatureofActivity").getSelectedKey(),sector:e.byId("sectorComboBox").getSelectedKeys(),FunctionandSubfunction:e.byId("childMultiComboBox").getSelectedKeys(),panCardNumber:e.byId("panInput").getValue(),gstinNumber:e.byId("gstinInput").getValue(),supplierFullName:e.byId("SupplierNameInput").getValue(),supplierTradeName:e.byId("SuppliertradeNameInput").getValue(),supplierAddress:e.byId("SupplierAddressInput").getValue(),supplierGstAddress:e.byId("SupplierAddressgstInput").getValue(),primaryFirstName:e.byId("PrimaryFirstnameInput").getValue(),primaryLastName:e.byId("PrimaryLastnameInput").getValue(),primaryEmail:e.byId("emailInput").getValue(),primaryPhone:e.byId("numberInput").getValue()};if(o.relatedParty==="Yes"){o.relatedParty=true}else{o.relatedParty=false}var r={DigressionVendorCodeVal:o.validity,IsRelPartyVCode:o.relatedParty,SpendType:o.supplierSpendType,NatureOfActivity:o.natureOfActivity,Sector:o.sector,FunAndSubfun:o.FunctionandSubfunction,PANCardNo:o.panCardNumber,GSTIN:o.gstinNumber,SFullName:o.supplierFullName,STradeNameGST:o.supplierTradeName,SAddress:o.supplierAddress,SAddressGST:o.supplierGstAddress,PriContactFName:o.primaryFirstName,PriContactLName:o.primaryLastName,PriContactEmail:o.primaryEmail,PriContactMNumber:o.primaryPhone};console.log(o);console.log(r);a.setUseBatch(false);a.create("/supplierReqSrv",r,{method:"POST",success:function(e){t.show("Form submitted successfully."+e.ID)},error:function(){t.show("Error while submitting the Form.")}});t.show("Form submitted successfully!")},onReadSector:function(){var e=this;var t=this.getOwnerComponent().getModel();t.read("/SectorSrv",{success:function(t){console.log(t);var a=new sap.ui.model.json.JSONModel(t);e.getView().byId("sectorComboBox").setModel(a)},error:function(e){console.log(e)}})},onReadNatureofActivity:function(){var e=this;var t=this.getOwnerComponent().getModel();t.read("/NatureOfActivitySrv",{success:function(t){console.log(t);var a=new sap.ui.model.json.JSONModel(t);e.getView().byId("NatureofActivity").setModel(a)},error:function(e){console.log(e)}})},onReadSupplierSpendType:function(){var e=this;var t=this.getOwnerComponent().getModel();t.read("/SupplierSpendTypeSrv",{success:function(t){console.log(t);var a=new sap.ui.model.json.JSONModel(t);e.getView().byId("supplierSpendType").setModel(a)},error:function(e){console.log(e)}})},onSave:function(){var e=this.getView();var a={validity:e.byId("datePicker").getDateValue(),relatedParty:e.byId("radioGroup").getSelectedButton().getText(),supplierSpendType:e.byId("supplierSpendType").getSelectedKey(),natureOfActivity:e.byId("NatureofActivity").getSelectedKey(),sector:e.byId("sectorComboBox").getSelectedKeys().join(", "),FunctionandSubfunction:e.byId("childMultiComboBox").getSelectedKeys(),panCardNumber:e.byId("panInput").getValue(),gstinNumber:e.byId("gstinInput").getValue(),supplierFullName:e.byId("SupplierNameInput").getValue(),supplierTradeName:e.byId("SuppliertradeNameInput").getValue(),supplierAddress:e.byId("SupplierAddressInput").getValue(),supplierGstAddress:e.byId("SupplierAddressgstInput").getValue(),primaryFirstName:e.byId("PrimaryFirstnameInput").getValue(),primaryLastName:e.byId("PrimaryLastnameInput").getValue(),primaryEmail:e.byId("emailInput").getValue(),primaryPhone:e.byId("numberInput").getValue()};var o=JSON.stringify(a);localStorage.setItem("formData",o);console.log(a);t.show("Form data saved successfully in local storage.")},onReadDepartments:function(){var e=this;var t=this.getOwnerComponent().getModel();t.read("/departmentsSrv",{success:function(t){console.log("Departments Data:",t);var a=new sap.ui.model.json.JSONModel(t);e.getView().setModel(a,"departmentsModel");var o=e.getView().byId("FunctionandSubfunctionComboBox");var r=o.getItems();if(r&&r.length>0){o.setSelectedItem(r[0]);e.onDepartmentChange({getParameter:function(){return r[0]}})}},error:function(e){console.log("Error fetching departments data:",e)}})},onDepartmentChange:function(e){var t=this;var a=e.getParameter("selectedItem");console.log("Selected Item:",a);if(a){var o=a.getBindingContext("departmentsModel").getObject();console.log("Selected Department:",o);if(o.Functions&&o.Functions.length>0){console.log("Functions:",o.Functions);var r=new sap.ui.model.json.JSONModel({Functions:o.Functions});t.getView().byId("childMultiComboBox").setModel(r,"functionsModel")}else{console.log("No functions available for the selected department.")}}}})});
//# sourceMappingURL=RequestForm.controller.js.map