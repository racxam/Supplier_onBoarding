sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/Icon","sap/m/Link","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/Dialog","sap/m/Button","sap/m/Text"],function(e,t,o,a,n,i,s,r){"use strict";return e.extend("com.sumo.supplieronboarding.controller.RequestForm",{onInit:function(){var e=new sap.ui.model.json.JSONModel({documentfiles:[]});this.getView().setModel(e);this.onReadSupplierSpendType();this.onReadNatureofActivity();this.onReadSector();this.onReadDepartments();var t=new Date;var o=new Date;o.setFullYear(t.getFullYear()+4);var a=this.byId("datePicker");a.setMinDate(t);a.setMaxDate(o);var e=new sap.ui.model.json.JSONModel({panCardValue:"",gstinValue:"",emailValue:"",numberValue:"",pan:[],gst:[]});this.getView().setModel(e)},onPanCardChange:function(e){var t=e.getSource();var o=t.getValue();var a=/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/;if(a.test(o)){t.setValueState("Success")}else{t.setValueState("Error")}},onGSTINChange:function(e){var t=e.getSource();var o=t.getValue();var a=/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;var n=this.getView().getModel().getProperty("/panCardValue");if(a.test(o)){var i=o.substring(2,12);if(i===n){t.setValueState("Success")}else{t.setValueState("Error");t.setValueStateText("The PAN part of the GSTIN does not match the entered PAN.")}}else{t.setValueState("Error");t.setValueStateText("Invalid GSTIN format. Please enter a valid GSTIN.")}},onSubmitpan:function(){var e=this.byId("panInput");var o=e.getValue();if(e.getValueState()==="Success"){t.show("PAN Card number is valid: "+o)}else{t.show("Please enter a valid PAN Card number.")}},onSubmitgst:function(){var e=this.byId("gstinInput").getValue().trim();var o=this.getView().getModel("customerModel");var a=o.getProperty("/customers");var n=a.find(function(t){return t.GSTIN===e});if(n){var i=new sap.m.Dialog({title:"Customer Details",content:new sap.m.Text({text:"  Name: "+n.Name+"\n"+"  Address: "+n.Address+"\n"+"  Contact Number: "+n.ContactNumber}),beginButton:new sap.m.Button({text:"OK",press:function(){i.close()}}),afterClose:function(){i.destroy()}});i.open()}else{t.show("GSTIN not found!")}},onEmailChange:function(e){var t=e.getSource();var o=t.getValue();var a=/^[a-zA-Z0-9!#$%&'*+?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+?^_`{|}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])$/;if(a.test(o)){t.setValueState("Success")}else{t.setValueState("Error")}},onSubmitemail:function(){var e=this.byId("emailInput");var o=e.getValue();if(e.getValueState()==="Success"){t.show("Email is valid: "+o)}else{t.show("Please enter a valid email address.")}},onNumberChange:function(e){var t=e.getSource();var o=t.getValue();o=o.replace(/\D/g,"");if(o.length>10){o=o.substring(0,10)}t.setValue(o);if(o.length===10){t.setValueState("Success")}else{t.setValueState("Error");t.setValueStateText("Mobile number must be 10 digits.")}},onSubmitnumber:function(){var e=this.byId("numberInput");var o=e.getValue();if(e.getValueState()==="Success"){t.show("Number is valid: "+o)}else{t.show("Please enter a valid Mobile number.")}},onDownload:function(e){var t=e.getSource();var o=t.getCustomData()[0].getValue();var a=t.getText();var n=document.createElement("a");n.href=o;n.download=a;document.body.appendChild(n);n.click();document.body.removeChild(n)},onDeleteFilepan:function(e){var o=e.getSource();var a=o.getParent().getParent();var n=this.getView().getModel();var i=n.getProperty("/pan");var s=a.getBindingContext().getPath().split("/").pop();i.splice(s,1);n.setProperty("/pan",i);t.show("File deleted successfully.")},onDeleteFilegst:function(e){var o=e.getSource();var a=o.getParent().getParent();var n=this.getView().getModel();var i=n.getProperty("/gst");var s=a.getBindingContext().getPath().split("/").pop();i.splice(s,1);n.setProperty("/gst",i);t.show("File deleted successfully.")},onFileUploadpan:function(e){var o=e.getSource();var a=o.oFileUpload.files[0];if(a){var n=a.name;var i=new FileReader;var s=this;i.onload=function(e){var o=e.target.result;var a=s.getView().getModel();var i=a.getProperty("/pan");i.push({fileName:n,fileUrl:o});a.setProperty("/pan",i);console.log("Updated /Pan attachment:",a.getProperty("/pan"));t.show("File "+n+" uploaded successfully.");a.refresh(true)};i.readAsDataURL(a)}},formatAttachmentButtonTextpan:function(e){if(e&&e.length>0){return"View Attachments ("+e.length+")"}else{return"View Attachments (0)"}},onOpenDialogpan:function(){if(!this._oPanDialog){this._oPanDialog=this.getView().byId("panDialog");if(!this._oPanDialog){this._oPanDialog=sap.ui.xmlfragment("com.sumo.supplieronboarding.view.fragment.uploadfile",this);this.getView().addDependent(this._oPanDialog)}}this._oPanDialog.open()},onCloseDialogpan:function(){if(this._oPanDialog){this._oPanDialog.close()}},onFormsubmit:function(){var e=this.getView();var o=this.getOwnerComponent().getModel();console.log(o);var a={DigressionVendorCodeVal:"2025-09-30",IsRelPartyVCode:true,SpendType:"Indirect",NatureOfActivity:"Material",Sector:["IT","Manufacturing"],FunAndSubfun:["Finance","HR"],PANCardNo:"ABCDE1234F",GSTIN:"27ABCDE1234F1Z5",SFullName:"ABC Corp Pvt. Ltd.",STradeNameGST:"ABC Trade",SAddress:"123, Example Street, City, State",SAddressGST:"123, Example Street, City, State",PriContactFName:"Sumit",PriContactLName:"Doe",PriContactEmail:"john.doe@example.com",PriContactMNumber:"1234567890"};o.setUseBatch(false);o.create("/supplierReqSrv",a,{method:"POST",success:function(e){t.show("Form submitted successfully."+e.ID);console.log(e.ID);this.onUploadFile(e.ID);console.log("----------\x3eUpload")}.bind(this),error:function(){t.show("Error while submitting the Form.")}});t.show("Form submitted successfully!")},onUploadFile:function(e){console.log("On Upload file---------\x3e");const o=(e,o)=>{e.forEach((e,a)=>{var n={Req_Supplier_ID:o,Doc_Type:e.Doc_Type,Attachment_ID:a+1,fileName:e.fileName,mediaType:e.fileType,content:e.fileContent};console.log("GGGGGGGGGGGGGGG",n);var i=this.getOwnerComponent().getModel();i.setUseBatch(false);i.create("/SReqattachmentsSrv",n,{method:"POST",success:function(e){t.show("Attachments uploaded successfully: "+e.ID)}.bind(this),error:function(){t.show("Error while Uploading the Attachments.")}})})};var a=this.getView().getModel();var n=a.getProperty("/documentFiles");var i=n.pan.concat(n.gst);console.log(i);console.log(`++++++++++ ${i}++++++++++`);o(i,e)},onFileUpload:function(e){var o=e.getSource();var a=o.oFileUpload.files[0];if(a){var n=a.name;var i=n.split(".").pop();var s=new FileReader;var r=this;s.onload=function(e){var a=e.target.result;console.log("Base64 File URL: ",a);var s=r.getView().getModel();var l=s.getProperty("/documentFiles")||{pan:[],gst:[],cin:[]};var u=l.pan.length+1;var c=l.gst.length+1;var d=l.cin.length+1;var g=o.getId();var p="";var m="";if(g.includes("fileUploaderPan")){p="PAN";m="PAN-"+u;l.pan.push({fileName:n,fileUrl:a,fileContent:a,fileType:i,Doc_Type:"PAN",attachmentId:m})}else if(g.includes("fileUploaderGst")){p="GST";m="GST-"+c;l.gst.push({fileName:n,fileUrl:a,fileContent:a,fileType:i,Doc_Type:"GST",attachmentId:m})}else if(g.includes("fileUploaderCin")){p="CIN";m="CIN-"+d;l.cin.push({fileName:n,fileUrl:a,fileContent:a,fileType:i,Doc_Type:"CIN",attachmentId:m})}s.setProperty("/documentFiles",l);console.log("Updated /documentFiles:",s.getProperty("/documentFiles"));t.show(p+" file "+n+" uploaded successfully.");s.refresh(true)};s.readAsDataURL(a)}},formatAttachmentButtonText:function(e,t){e=e||[];return"View Attachments ("+e.length+")"},onOpenDialog:function(e){if(!this._oDialog){this._oDialog=sap.ui.xmlfragment("com.sumo.supplieronboarding.view.fragment.uploadfile",this);this.getView().addDependent(this._oDialog)}var t=this.getView().getModel();var o=t.getProperty("/documentFiles/"+e)||[];var a=new sap.ui.model.json.JSONModel({documentFiles:o});this._oDialog.setModel(a);this._oDialog.data("documentType",e);this._oDialog.open()},onCloseDialog:function(){if(this._oDialog){this._oDialog.close()}},onDownloadFile:function(e){const o=e.getSource().data("fileName");const a=this._oDialog.data("documentType");var n=this.getView().getModel();var i=n.getProperty("/documentFiles/"+a);var s=i.find(e=>e.fileName===o);console.log("Selected File: ",s);if(s&&s.fileContent){const e=this._base64ToBlob(s.fileContent);const t=document.createElement("a");t.href=URL.createObjectURL(e);t.download=o;t.click()}else{t.show("File not found or missing content.")}},onDeleteFile:function(e){const o=e.getSource().data("fileName");const a=this._oDialog.data("documentType");sap.m.MessageBox.confirm(`Are you sure you want to delete the file "${o}"?`,{onClose:function(e){if(e==="OK"){const e=this.getView().getModel();const n=e.getProperty("/documentFiles/"+a);const i=n.filter(e=>e.fileName!==o);e.setProperty("/documentFiles/"+a,i);t.show(`File "${o}" deleted successfully.`);this.onCloseDialog()}}.bind(this)})},_base64ToBlob:function(e){if(e.startsWith("data:")){e=e.split(",")[1]}console.log("Base64 String: ",e);try{const t=atob(e);const o=[];for(let e=0;e<t.length;e+=512){const a=t.slice(e,e+512);const n=new Array(a.length);for(let e=0;e<a.length;e++){n[e]=a.charCodeAt(e)}const i=new Uint8Array(n);o.push(i)}return new Blob(o,{type:"application/octet-stream"})}catch(e){console.error("Base64 decoding failed: ",e);return null}},onReadSector:function(){console.log("I am sector srv");var e=this;var t=this.getOwnerComponent().getModel();t.read("/SectorSrv",{success:function(t){console.log(t);var o=new sap.ui.model.json.JSONModel(t);e.getView().byId("sectorComboBox").setModel(o)},error:function(e){console.log(e)}})},onReadNatureofActivity:function(){var e=this;var t=this.getOwnerComponent().getModel();t.read("/NatureOfActivitySrv",{success:function(t){console.log(t);var o=new sap.ui.model.json.JSONModel(t);e.getView().byId("NatureofActivity").setModel(o)},error:function(e){console.log(e)}})},onReadSupplierSpendType:function(){var e=this;var t=this.getOwnerComponent().getModel();t.read("/SupplierSpendTypeSrv",{success:function(t){console.log(t);var o=new sap.ui.model.json.JSONModel(t);e.getView().byId("supplierSpendType").setModel(o)},error:function(e){console.log(e)}})},onSave:function(){var e=this.getView();var o={validity:e.byId("datePicker").getDateValue(),relatedParty:e.byId("radioGroup").getSelectedButton().getText(),supplierSpendType:e.byId("supplierSpendType").getSelectedKey(),natureOfActivity:e.byId("NatureofActivity").getSelectedKey(),sector:e.byId("sectorComboBox").getSelectedKeys().join(", "),FunctionandSubfunction:e.byId("childMultiComboBox").getSelectedKeys(),panCardNumber:e.byId("panInput").getValue(),gstinNumber:e.byId("gstinInput").getValue(),supplierFullName:e.byId("SupplierNameInput").getValue(),supplierTradeName:e.byId("SuppliertradeNameInput").getValue(),supplierAddress:e.byId("SupplierAddressInput").getValue(),supplierGstAddress:e.byId("SupplierAddressgstInput").getValue(),primaryFirstName:e.byId("PrimaryFirstnameInput").getValue(),primaryLastName:e.byId("PrimaryLastnameInput").getValue(),primaryEmail:e.byId("emailInput").getValue(),primaryPhone:e.byId("numberInput").getValue()};var a=JSON.stringify(o);localStorage.setItem("formData",a);console.log(o);t.show("Form data saved successfully in local storage.")},onReadDepartments:function(){var e=this;var t=this.getOwnerComponent().getModel();t.read("/departmentsSrv",{success:function(t){console.log("Departments Data:",t);var o=new sap.ui.model.json.JSONModel(t);e.getView().setModel(o,"departmentsModel");var a=e.getView().byId("FunctionandSubfunctionComboBox");var n=a.getItems();if(n&&n.length>0){a.setSelectedItem(n[0]);e.onDepartmentChange({getParameter:function(){return n[0]}})}},error:function(e){console.log("Error fetching departments data:",e)}})},onDepartmentChange:function(e){var t=this;var o=e.getParameter("selectedItem");console.log("Selected Item:",o);if(o){var a=o.getBindingContext("departmentsModel").getObject();console.log("Selected Department:",a);if(a.Functions&&a.Functions.length>0){console.log("Functions:",a.Functions);var n=new sap.ui.model.json.JSONModel({Functions:a.Functions});t.getView().byId("childMultiComboBox").setModel(n,"functionsModel")}else{console.log("No functions available for the selected department.")}}}})});
//# sourceMappingURL=RequestForm.controller.js.map