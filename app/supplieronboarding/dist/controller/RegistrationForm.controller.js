sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast"],function(e,t){"use strict";return e.extend("com.sumo.supplieronboarding.controller.RegistrationForm",{onInit:function(){var e=new sap.ui.model.json.JSONModel({documentfiles:[]});this.getView().setModel(e);this._loadMyFragment()},_loadMyFragment:function(){this.loadFragment({name:"com.sumo.supplieronboarding.view.fragment.uploadfiles"}).then(function(e){this.byId("fileListFragment2").addItem(e)}.bind(this))},onOpenDialog:function(){var e=this.getView();var t=e.byId("fileUploadDialog");t.open()},onCloseDialog:function(){var e=this.getView().byId("fileUploadDialog");e.close()},onFileChange:function(e){var t=e.getParameter("files");if(t.length>0){console.log("Selected file: "+t[0].name)}},onUploadComplete:function(e){var t=e.getParameter("response");console.log("Upload complete. Response: ",t)},onUploadFile:function(){var e=this.getView().byId("fileUploader");e.upload()},onAfterItemAdded:function(e){var t=e.getParameter("item");this._createEntity(t).then(e=>{this._uploadContent(t,e)}).catch(e=>{console.log(e)})},onUploadCompleted:function(e){var t=this.byId("uploadSet");t.removeAllIncompleteItems();t.getBinding("items").refresh()},onOpenPressed:function(e){e.preventDefault();var t=e.getSource();this._fileName=t.getFileName();this._download(t).then(e=>{var t=window.URL.createObjectURL(e);var o=document.createElement("a");o.href=t;o.setAttribute("download",this._fileName);document.body.appendChild(o);o.click();document.body.removeChild(o)}).catch(e=>{console.log(e)})},_createEntity:function(e){var t={mediaType:e.getMediaType(),fileName:e.getFileName(),size:e.getFileObject().size};var o={url:"/odata/v4/attachments/Files",method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(t)};return new Promise((e,t)=>{$.ajax(o).done((t,o,a)=>{e(t.ID)}).fail(e=>{t(e)})})},_uploadContent:function(e,t){var o=`/odata/v4/attachments/Files(${t})/content`;e.setUploadUrl(o);var a=this.byId("uploadSet");a.setHttpRequestMethod("PUT");a.uploadItem(e)},onOpenDialog:function(){var e=this.getView();var t=e.byId("fileUploadDialog");t.open()},onCloseDialog:function(){var e=this.getView().byId("fileUploadDialog");e.close()},onFileChange:function(e){var t=e.getParameter("files");if(t.length>0){console.log("Selected file: "+t[0].name)}},onUploadComplete:function(e){var t=e.getParameter("response");console.log("Upload complete. Response: ",t)},onUploadFile:function(){var e=this.getView().byId("fileUploader");e.upload()},handleUploadPress:function(e){var t=this.getView().byId("fileUploader");t.upload()},onFileUpload:function(e){var o=e.getSource();var a=o.oFileUpload.files[0];if(a){var n=a.name;var i=new FileReader;var s=this;i.onload=function(e){var o=e.target.result;var a=s.getView().getModel();var i=a.getProperty("/documentfiles");i.push({fileName:n,fileUrl:o});a.setProperty("/documentfiles",i);console.log("Updated /documentfiles array:",a.getProperty("/documentfiles"));t.show("File "+n+" uploaded successfully.");a.refresh(true)};i.readAsDataURL(a)}},formatAttachmentButtonText:function(e){if(e&&e.length>0){return"View Attachments ("+e.length+")"}else{return"View Attachments (0)"}},onOpenDialog:function(){if(!this._oDialog){this._oDialog=sap.ui.xmlfragment("com.sumo.supplieronboarding.view.fragment.uploadfile",this);this.getView().addDependent(this._oDialog)}this._oDialog.open()},onCloseDialog:function(){this._oDialog.close()},onDownloadFile:function(e){const o=e.getSource().data("fileName");this.getView().getModel().read(`/documentfiles('${o}')/fileContent`,{success:function(e){const t=e.fileContent;const a=this._base64ToBlob(t);const n=document.createElement("a");n.href=URL.createObjectURL(a);n.download=o;n.click()}.bind(this),error:function(){t.show("Failed to download file")}})},onDeleteFile:function(e){const o=e.getSource().data("fileName");sap.m.MessageBox.confirm(`Are you sure you want to delete the file "${o}"?`,{onClose:function(e){if(e==="OK"){this.getView().getModel().remove(`/documentfiles('${o}')`,{success:function(){t.show(`File "${o}" deleted successfully.`);this.getView().getModel().refresh()}.bind(this),error:function(){t.show("Failed to delete file")}})}}.bind(this)})},_base64ToBlob:function(e){const t=atob(e);const o=[];for(let e=0;e<t.length;e+=512){const a=t.slice(e,e+512);const n=new Array(a.length);for(let e=0;e<a.length;e++){n[e]=a.charCodeAt(e)}const i=new Uint8Array(n);o.push(i)}return new Blob(o,{type:"application/octet-stream"})},onValidateCIN:function(){var e=this.getView().byId("cinInput");var t=e.getValue();var o=/^([LUu]{1})([0-9]{5})([A-Za-z]{2})([0-9]{4})([A-Za-z]{3})([0-9]{6})$/;if(o.test(t)){sap.m.MessageToast.show("Valid CIN Number")}else{sap.m.MessageToast.show("Invalid CIN Number");e.setValueState(sap.ui.core.ValueState.Error)}},onValidateEPFONumber:function(){var e=this.getView().byId("epfoInput");var t=e.getValue();var o=/^([A-Z]{2})\s([A-Z]{3})\s([0-9]{7})\s([0-9]{3})\s([0-9]{7})$/;if(o.test(t)){sap.m.MessageToast.show("Valid EPFO Number");e.setValueState(sap.ui.core.ValueState.Success)}else{sap.m.MessageToast.show("Invalid EPFO Number");e.setValueState(sap.ui.core.ValueState.Error)}},onValidateDUNSNumber:function(){var e=this.getView().byId("dunsInput");var t=e.getValue();var o=/^\d{9}$/;if(o.test(t)){sap.m.MessageToast.show("Valid DUNS Number");e.setValueState(sap.ui.core.ValueState.Success)}else{sap.m.MessageToast.show("Invalid DUNS Number");e.setValueState(sap.ui.core.ValueState.Error)}},onValidateLEINumber:function(){var e=this.getView().byId("leiInput");var t=e.getValue();var o=/^[A-Z0-9]{4}00[A-Z0-9]{14}$/;if(o.test(t)){sap.m.MessageToast.show("Valid LEI Number");e.setValueState(sap.ui.core.ValueState.Success)}else{sap.m.MessageToast.show("Invalid LEI Number");e.setValueState(sap.ui.core.ValueState.Error)}},SubmitSupplieronBoardForm:function(){var e=sap.ui.getCore().byId("_IDGenInput2").getValue();var o=parseInt(sap.ui.getCore().byId("_IDGenInput3").getValue());var a=parseInt(sap.ui.getCore().byId("_IDGenInput1").getValue());var n=parseInt(sap.ui.getCore().byId("_IDGenInput4").getValue());var i=sap.ui.getCore().byId("_IDGenInput5").getValue();var s={};s.Name=e;s.Salary=o;s.Id=a;s.Age=n;s.City=i;this.getView().getModel().create("/ZUSERDATASet",s,{method:"POST",success:function(e){t.show("Employee Created Successfully")},error:function(e){t.show(e)}})}})});
//# sourceMappingURL=RegistrationForm.controller.js.map