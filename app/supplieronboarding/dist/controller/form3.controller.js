sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/Icon","sap/m/Link","sap/ui/core/Fragment","sap/m/Dialog","sap/m/Button","sap/m/Text"],function(e,o,t,n,s,i,a,r,l,c){"use strict";return e.extend("com.sumo.supplieronboarding.controller.form3",{onInit:function(){var e=new sap.ui.model.json.JSONModel({documentfiles:[]});this.getView().setModel(e);this.onReadform();this.onReadAttachments()},onReadform:function(){var e=this.getView();var o=e.byId("requestId");var t=o.getText();console.log("Req ID Value: "+t);var n=this;var s=this.getOwnerComponent().getModel();var i=new sap.ui.model.Filter("ID","EQ",t);s.read("/supplierReqSrv",{filters:[i],success:function(e){console.log("my form data",e);if(e&&e.results&&e.results.length>0){var o=new sap.ui.model.json.JSONModel(e.results[0]);n.getView().byId("requestFormList").setModel(o);console.log("my form data request submit",o)}else{console.warn("No data found in results.")}},error:function(e){console.error("Error fetching data",e)}})},onReadAttachments:function(){var e=this;var o=this.getOwnerComponent().getModel();var t=new sap.ui.model.Filter("Req_Supplier_ID","EQ","2c6444b4-af03-4a61-8a27-37af63ed9a03");o.read("/SReqattachmentsSrv",{filters:[t],success:function(o){if(o&&o.results&&o.results.length>0){var t=o.results;var n={pan:t.filter(e=>e.Doc_Type==="PAN"),gst:t.filter(e=>e.Doc_Type==="GST"),cin:t.filter(e=>e.Doc_Type==="CIN")};var s=e.getView().getModel();s.setProperty("/documentFiles",n);console.log("Updated /documentFiles:",s.getProperty("/documentFiles"))}else{console.warn("No data found in results.")}},error:function(e){console.error("Error fetching data",e)}})},formatAttachmentButtonText:function(e,o){e=e||[];return"View Attachments ("+e.length+")"},onOpenDialog:function(e){if(!this._oDialog){this._oDialog=sap.ui.xmlfragment("com.sumo.supplieronboarding.view.fragment.uploadfile",this);this.getView().addDependent(this._oDialog)}var o=this.getView().getModel();var t=o.getProperty("/documentFiles/"+e)||[];var n=new sap.ui.model.json.JSONModel({documentFiles:t});this._oDialog.setModel(n);this._oDialog.data("documentType",e);this._oDialog.open()},onCloseDialog:function(){if(this._oDialog){this._oDialog.close()}},onDownloadFile:function(e){const o=e.getSource().data("fileName");const n=this._oDialog.data("documentType");var s=this.getView().getModel();var i=s.getProperty("/documentFiles/"+n);var a=i.find(e=>e.fileName===o);console.log("Selected File: ",a);if(a&&a.__metadata&&a.__metadata.media_src){var r=a.__metadata.media_src;fetch(r).then(e=>{if(!e.ok){throw new Error("File format not supported or file unavailable")}return e.blob()}).then(e=>{const t=e.type||"application/octet-stream";const n=document.createElement("a");n.href=URL.createObjectURL(e);n.download=o;n.click()}).catch(e=>{console.error("Error fetching file content: ",e);t.show("Error downloading file: Unsupported format or unavailable.")})}else{t.show("File not found or missing content.")}},onDeleteFile:function(e){const o=e.getSource().data("fileName");const n=this._oDialog.data("documentType");sap.m.MessageBox.confirm(`Are you sure you want to delete the file "${o}"?`,{onClose:function(e){if(e==="OK"){const e=this.getView().getModel();const s=e.getProperty("/documentFiles/"+n);const i=s.filter(e=>e.fileName!==o);e.setProperty("/documentFiles/"+n,i);t.show(`File "${o}" deleted successfully.`);this.onCloseDialog()}}.bind(this)})},_base64ToBlob:function(e){if(e.startsWith("data:")){e=e.split(",")[1]}console.log("Base64 String: ",e);try{const o=atob(e);const t=[];for(let e=0;e<o.length;e+=512){const n=o.slice(e,e+512);const s=new Array(n.length);for(let e=0;e<n.length;e++){s[e]=n.charCodeAt(e)}const i=new Uint8Array(s);t.push(i)}return new Blob(t,{type:"application/octet-stream"})}catch(e){console.error("Base64 decoding failed: ",e);return null}},onPressApprovalLogs:function(){console.log("deep inside");if(!this._oDialog){this._oDialog=sap.ui.xmlfragment("com.sumo.supplieronboarding.view.fragment.timelinePopup",this);this.getView().addDependent(this._oDialog)}this._oDialog.open()}})});
//# sourceMappingURL=form3.controller.js.map